{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect } from 'react';\nimport { DragDropContext, Droppable } from 'react-beautiful-dnd';\nimport Top from './top';\nimport Column from './column';\nimport AddColumn from './add-column';\nimport Archive from './archive';\nimport CardModal from './card-modal';\nimport { useSnackbar } from 'notistack';\n\nfunction Board(props) {\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const {\n    0: state,\n    1: setState\n  } = useState({\n    columns: {},\n    columnOrder: [],\n    archive: {\n      _id: 'archive',\n      title: 'Archive',\n      cards: [],\n      colorIndex: 0,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    }\n  });\n  const {\n    0: colorIndex,\n    1: setColorIndex\n  } = useState(0);\n  const {\n    0: currentCard,\n    1: setCurrentCard\n  } = useState({});\n  const {\n    0: currentColumn,\n    1: setCurrentColumn\n  } = useState({});\n  const {\n    0: isLoadingCompleted,\n    1: setIsLoadingCompleted\n  } = useState(false);\n  const {\n    0: archiveColumnId,\n    1: setArchiveColumnId\n  } = useState('');\n  useEffect(() => {\n    getColumns(props._id);\n  }, []);\n\n  const getColumns = _id => {\n    fetch(`/api/get-columns`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        _id\n      })\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        state.columnOrder = [...data.columnOrder];\n        state.archive = data.archive[0];\n        setArchiveColumnId(data.archive[0]._id);\n        data.columns.map(column => {\n          state.columns[column._id] = column;\n        });\n        setState(_objectSpread({}, state));\n        setColorIndex(data.columns.length);\n        setIsLoadingCompleted(true);\n      } else {}\n    }).catch(err => {\n      console.error(`Something wrong happened while getting a route:${err.message}`);\n    });\n  };\n\n  const addColumn = (sectionTitle, card) => {\n    fetch('/api/add-column', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        projectId: props._id,\n        title: sectionTitle,\n        colorIndex: colorIndex + 1\n      })\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        state.columns[data.data._id] = _objectSpread(_objectSpread({}, data.data), {}, {\n          cards: []\n        });\n        state.columnOrder.push(data.data._id);\n        setColorIndex(colorIndex + 1);\n        setState(_objectSpread({}, state));\n        handleSnackbar(`'${sectionTitle}' is created`, 'success');\n      } else {\n        handleSnackbar(`Failed to add a column`, 'error');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while adding a column:${err.message}`);\n    });\n  };\n\n  const updateCard = (columnId, card) => {\n    fetch(`/api/update-card`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(card)\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        state.columns[columnId].cards.map((item, index) => {\n          if (item._id === card._id) {\n            if (card.cardTitle) {\n              item.cardTitle = card.cardTitle;\n              addActivity(columnId, card._id, `Card title is changed to ${card.cardTitle}`);\n            }\n\n            if (card.note) {\n              item.note = card.note;\n              addActivity(columnId, card._id, `Card note is changed`);\n            }\n\n            if (card.isCardCompleted) {\n              item.isCardCompleted = card.isCardCompleted;\n              addActivity(columnId, card._id, `Card is completed`);\n            }\n\n            if (card.isArchived) {\n              let tempCard = {};\n              console.log(tempCard);\n              state.columns[columnId].cards.map((card, index) => {\n                if (item._id === card._id) {\n                  item.isArchived = true;\n                  item.columnId = 'archive';\n                  tempCard = card;\n                  state.columns[columnId].cards.splice(index, 1);\n                }\n              });\n              updateDate(columnId, card._id);\n              state.archive.cards.push(tempCard);\n              addActivity('archive', card._id, `Card is archived`);\n            }\n\n            if (card.dueDate) {\n              item.dueDate = card.dueDate;\n              addActivity(columnId, card._id, `A due date is set to ${convertDate(card.dueDate)}`);\n            }\n          }\n        });\n        updateDate(columnId, card._id);\n        setState(_objectSpread({}, state));\n      } else {\n        handleSnackbar('Something wrong happened while updating a card', 'warning');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while updating a card:${err.message}`);\n    });\n  };\n\n  const addCard = (columnId, cardTitle) => {\n    fetch(`/api/add-card`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        columnId,\n        cardTitle\n      })\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        state.columns[columnId].cards.push(data.data);\n        addActivity(columnId, data.data._id, `A card with title '${cardTitle}' is created in '${state.columns[columnId].title}'`);\n        updateDate(columnId, '');\n        setState(_objectSpread({}, state));\n      } else {\n        handleSnackbar('Something wrong happened while adding a card', 'warning');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while adding a card:${err.message}`);\n    });\n  };\n\n  const updateColumnTitle = (_id, title) => {\n    fetch(`/api/update-column-title`, {\n      method: 'PATCH',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        _id,\n        title\n      })\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        state.columns[_id].title = title;\n        state.columns[_id].updatedAt = new Date();\n        setState(_objectSpread({}, state));\n        handleSnackbar(`Column title is updated`, 'info');\n      } else {\n        handleSnackbar(`Failed to update a column title`, 'error');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while getting a route:${err.message}`);\n      handleSnackbar(`Failed to update a column title`, 'error');\n    });\n  };\n\n  const deleteColumn = columnId => {\n    const title = state.columns[columnId].title;\n    fetch(`/api/delete-column`, {\n      method: 'DELETE',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        projectId: props._id,\n        columnId\n      })\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        delete state.columns[columnId];\n        state.columnOrder.splice(state.columnOrder.indexOf(columnId), 1);\n        setState(_objectSpread({}, state));\n        handleSnackbar(`'${title}' is deleted`, 'error');\n      } else {\n        handleSnackbar(`Failed to delete a column`, 'warning');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while deleting a column:${err.message}`);\n    });\n  };\n\n  const deleteCard = (columnId, cardId) => {\n    fetch(`/api/delete-card`, {\n      method: 'DELETE',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        columnId,\n        cardId\n      })\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        state.columns[columnId].cards.map((card, index) => {\n          if (card._id === cardId) {\n            state.columns[columnId].cards.splice(index, 1);\n          }\n        });\n        updateDate(columnId, cardId);\n        handleSnackbar('A card is deleted', 'error');\n        setState(_objectSpread({}, state));\n      } else {\n        handleSnackbar(`Failed to delete a card`, 'warning');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while deleting a card:${err.message}`);\n    });\n  };\n\n  const archiveCard = (columnId, cardId) => {\n    fetch(`/api/archive-card`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        _id: cardId,\n        projectId: props._id\n      })\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        let tempCard = {};\n        state.columns[columnId].cards.map((card, index) => {\n          if (card._id === cardId) {\n            card.isArchived = true;\n            tempCard = card;\n            state.columns[columnId].cards.splice(index, 1);\n          }\n        });\n        updateDate(columnId, cardId);\n        state.archive.cards.push(tempCard);\n        addActivity(archiveColumnId, cardId, `Card is archived`);\n        setState(_objectSpread({}, state));\n      } else {\n        handleSnackbar('Something wrong happened while archiving a card', 'warning');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while archiving a card:${err.message}`);\n    });\n  };\n\n  const reorderCards = (column, cards) => {\n    fetch(`/api/reorder-card`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        columnId: column._id,\n        cards\n      })\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        handleSnackbar(`Cards are reordered in '${column.title}'`, 'success');\n      } else {\n        handleSnackbar('Something wrong happened while reordering cards in a same column', 'warning');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while reordering cards in a same column:${err.message}`);\n    });\n  };\n\n  const reorderColumns = (sourceIndex, destIndex, columnOrder) => {\n    fetch(`/api/reorder-column`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        _id: props._id,\n        columnOrder\n      })\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        handleSnackbar(`'${state.columns[state.columnOrder[sourceIndex]].title}' and '${state.columns[state.columnOrder[destIndex]].title}' are reordered`, 'success');\n      } else {\n        handleSnackbar('Something wrong happened while reordering columns', 'warning');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while reordering columns:${err.message}`);\n    });\n  };\n\n  const onDragEnd = result => {\n    if (!result.destination) {\n      return;\n    } // Move column\n\n\n    if (result.type === 'column') {\n      const columnOrder = reorder(state.columnOrder, result.source.index, result.destination.index);\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        columnOrder\n      }));\n      reorderColumns(result.source.index, result.destination.index, columnOrder);\n      return;\n    } // Reorder cards in a same column\n\n\n    if (result.source.droppableId === result.destination.droppableId) {\n      const column = state.columns[result.source.droppableId];\n      const cards = reorder(column.cards, result.source.index, result.destination.index);\n\n      const newState = _objectSpread(_objectSpread({}, state), {}, {\n        columns: _objectSpread(_objectSpread({}, state.columns), {}, {\n          [column._id]: _objectSpread(_objectSpread({}, column), {}, {\n            cards\n          })\n        })\n      });\n\n      reorderCards(column, cards);\n      setState(newState);\n      return;\n    } // Move a card to a different column\n\n\n    const sourceColumn = state.columns[result.source.droppableId];\n    const destinationColumn = state.columns[result.destination.droppableId];\n    const card = sourceColumn.cards[result.source.index];\n\n    const newSourceColumn = _objectSpread(_objectSpread({}, sourceColumn), {}, {\n      cards: [...sourceColumn.cards]\n    });\n\n    newSourceColumn.cards.splice(result.source.index, 1); // reorderCards(sourceColumn, newSourceColumn.cards as []);\n\n    const newDestinationColumn = _objectSpread(_objectSpread({}, destinationColumn), {}, {\n      cards: [...destinationColumn.cards]\n    });\n\n    newDestinationColumn.cards.splice(result.destination.index, 0, card);\n    reorderCards(destinationColumn, newDestinationColumn.cards);\n\n    const newState = _objectSpread(_objectSpread({}, state), {}, {\n      columns: _objectSpread(_objectSpread({}, state.columns), {}, {\n        [newSourceColumn._id]: newSourceColumn,\n        [newDestinationColumn._id]: newDestinationColumn\n      })\n    });\n\n    handleSnackbar(`A card is moved from '${newSourceColumn.title}' to '${newDestinationColumn.title}'`, 'success');\n    setState(newState);\n  };\n\n  const getItemStyle = (isDragging, draggableStyle) => _objectSpread({\n    display: 'flex',\n    flexDirection: 'row'\n  }, draggableStyle);\n\n  const reorder = (list, startIndex, endIndex) => {\n    const result = Array.from(list);\n    const [removed] = result.splice(startIndex, 1);\n    result.splice(endIndex, 0, removed);\n    return result;\n  };\n\n  const [open, setOpen] = React.useState(false);\n\n  const setCardForOpen = (columnId, cardId) => {\n    if (columnId === archiveColumnId) {\n      const card = state.archive.cards.filter(card => card._id === cardId);\n      setCurrentCard(card[0]);\n      setCurrentColumn(state.archive);\n    } else {\n      const card = state.columns[columnId].cards.filter(card => card._id === cardId);\n      setCurrentCard(card[0]);\n      setCurrentColumn(state.columns[columnId]);\n    }\n  };\n\n  const handleModalClose = () => {\n    setOpen(false);\n  };\n\n  const addChecklist = (columnId, cardId, checklist) => {\n    fetch(`/api/add-checklist`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        cardId,\n        checklist\n      })\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        state.columns[columnId].cards.map(card => {\n          if (card._id === cardId) {\n            card.checklists.push(data.data);\n          }\n        });\n        addActivity(columnId, cardId, `${checklist} is added to the checklist`);\n        updateDate(columnId, cardId);\n        setState(_objectSpread({}, state));\n      } else {\n        handleSnackbar('Something wrong happened while adding a checklist', 'warning');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while adding a checklist:${err.message}`);\n    });\n  };\n\n  const updateDate = (columnId, cardId) => {\n    if (cardId) {\n      state.columns[columnId].cards.map(card => {\n        if (card._id === cardId) {\n          card.updatedAt = new Date();\n        }\n      });\n    }\n\n    state.columns[columnId].updatedAt = new Date();\n    setState(_objectSpread({}, state));\n  };\n\n  const updateChecklist = (columnId, cardId, checklist) => {\n    fetch(`/api/update-checklist`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(checklist)\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        state.columns[columnId].cards.map(card => {\n          if (card._id === cardId) {\n            if (checklist.checklist) {\n              card.checklists.map(item => {\n                if (item._id === checklist._id) {\n                  item.checklist = checklist.checklist;\n                }\n              });\n              updateDate(columnId, cardId);\n              addActivity(columnId, cardId, `A checklist is updated to ${checklist.checklist}`);\n            }\n\n            if (checklist.isChecked !== undefined) {\n              if (checklist.isChecked) {\n                card.checklists.map(item => {\n                  if (item._id === checklist._id) {\n                    item.isChecked = true;\n                  }\n                });\n                updateDate(columnId, cardId);\n                addActivity(columnId, cardId, `A checklist is completed`);\n              }\n\n              console.log(checklist.isChecked);\n\n              if (!checklist.isChecked) {\n                card.checklists.map(item => {\n                  if (item._id === checklist._id) {\n                    item.isChecked = false;\n                  }\n                });\n                updateDate(columnId, cardId);\n                addActivity(columnId, cardId, `A checklist is incompleted`);\n              }\n            }\n          }\n        });\n        setState(_objectSpread({}, state));\n      } else {\n        handleSnackbar('Something wrong happened while updating a checklist', 'warning');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while updating a checklist:${err.message}`);\n    });\n  };\n\n  const deleteChecklist = (columnId, cardId, checklistId) => {\n    fetch(`/api/delete-checklist`, {\n      method: 'DELETE',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        _id: checklistId\n      })\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        state.columns[columnId].cards.map(card => {\n          if (card._id === cardId) {\n            card.checklists = card.checklists.filter(checklist => checklist._id !== checklistId);\n          }\n        });\n        updateDate(columnId, cardId);\n        addActivity(columnId, cardId, `A checklist is deleted`);\n        setState(_objectSpread({}, state));\n      } else {\n        handleSnackbar(`Failed to delete a checklist`, 'warning');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while deleting a checklist:${err.message}`);\n    });\n  };\n\n  const convertDate = date => {\n    const formattedDate = new Date(date);\n    const month = formattedDate.toString().split(' ')[1];\n    const day = formattedDate.toString().split(' ')[2];\n    const year = formattedDate.toString().split(' ')[3];\n    return `${month} ${day}, ${year}`;\n  };\n\n  const addActivity = (columnId, cardId, activity) => {\n    fetch(`/api/add-activity`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        cardId,\n        activity\n      })\n    }).then(res => res.json()).then(data => {\n      if (data.success) {\n        if (columnId === archiveColumnId) {\n          state.archive.cards.map(card => {\n            if (card._id === cardId) {\n              card.activities.unshift(data.data);\n            }\n          });\n        } else {\n          state.columns[columnId].cards.map(card => {\n            if (card._id === cardId) {\n              card.activities.unshift(data.data);\n            }\n          });\n        }\n\n        if (activity.toLowerCase().includes('archive')) {\n          handleSnackbar(activity, 'warning');\n        } else {\n          handleSnackbar(activity, 'info');\n        }\n\n        setState(_objectSpread({}, state));\n      } else {\n        handleSnackbar('Something wrong happened while adding an activity', 'warning');\n      }\n    }).catch(err => {\n      console.error(`Something wrong happened while getting an activity:${err.message}`);\n    });\n  };\n\n  const handleSnackbar = (message, variant) => {\n    enqueueSnackbar(message, {\n      variant\n    });\n  };\n\n  return __jsx(React.Fragment, null, isLoadingCompleted && __jsx(React.Fragment, null, __jsx(Top, {\n    _id: props._id,\n    changeProjectName: props.changeProjectName,\n    projectName: props.projectName\n  }), __jsx(\"div\", {\n    className: \"board\"\n  }, __jsx(DragDropContext, {\n    onDragEnd: onDragEnd\n  }, __jsx(Droppable, {\n    direction: \"horizontal\",\n    droppableId: \"all-droppables\",\n    type: \"column\"\n  }, (provided, snapshot) => __jsx(\"div\", _extends({\n    ref: provided.innerRef\n  }, provided.droppableProps, {\n    style: getItemStyle(snapshot.isDragging, provided.droppableProps.style)\n  }), state.columnOrder.map((columnId, index) => {\n    return __jsx(Column, {\n      key: columnId,\n      column: state.columns[columnId],\n      index: index,\n      addCard: addCard,\n      setOpen: setOpen,\n      setCardForOpen: setCardForOpen,\n      updateColumnTitle: updateColumnTitle,\n      deleteColumn: deleteColumn,\n      convertDate: convertDate,\n      open: true,\n      projectName: props.projectName,\n      handleModalClose: handleModalClose,\n      addChecklist: addChecklist,\n      updateChecklist: updateChecklist,\n      addActivity: addActivity,\n      updateDate: updateDate,\n      updateCard: updateCard,\n      deleteChecklist: deleteChecklist,\n      deleteCard: deleteCard,\n      archiveCard: archiveCard,\n      archiveColumnId: archiveColumnId\n    });\n  }), provided.placeholder))), state.archive.cards.length > 0 && __jsx(Archive, {\n    index: 0,\n    column: state.archive,\n    archiveColumnId: archiveColumnId,\n    setCardForOpen: setCardForOpen,\n    convertDate: convertDate,\n    setOpen: setOpen,\n    open: true,\n    projectName: props.projectName,\n    handleModalClose: handleModalClose,\n    updateColumnTitle: updateColumnTitle,\n    deleteColumn: deleteColumn,\n    addChecklist: addChecklist,\n    updateChecklist: updateChecklist,\n    addActivity: addActivity,\n    updateDate: updateDate,\n    updateCard: updateCard,\n    deleteChecklist: deleteChecklist,\n    deleteCard: deleteCard,\n    addCard: addCard,\n    archiveCard: archiveCard\n  }), __jsx(AddColumn, {\n    colorIndex: colorIndex,\n    addColumn: addColumn\n  })), open && __jsx(CardModal, {\n    open: true,\n    addCard: addCard,\n    projectName: props.projectName,\n    currentCard: currentCard,\n    currentColumn: currentColumn,\n    handleModalClose: handleModalClose,\n    addChecklist: addChecklist,\n    updateChecklist: updateChecklist,\n    addActivity: addActivity,\n    updateDate: updateDate,\n    updateCard: updateCard,\n    deleteChecklist: deleteChecklist,\n    convertDate: convertDate,\n    deleteCard: deleteCard,\n    archiveCard: archiveCard\n  })));\n}\n\nexport default Board;","map":null,"metadata":{},"sourceType":"module"}